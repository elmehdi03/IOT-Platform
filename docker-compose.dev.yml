version: '3.8'

# Configuration de d√©veloppement avec hot-reload
services:
  iotplatform:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: iotplatform-app-dev
    ports:
      - "8080:8080"
      - "8000:8000"  # Port debug Java
    volumes:
      # Montage du fichier JSON pour la persistance
      - ./sensor_data.json:/app/sensor_data.json
      # Logs accessibles localement
      - ./logs:/usr/local/tomee/logs
      # Montage du WAR pour hot-reload (optionnel)
      - ./target/iotplatform.war:/usr/local/tomee/webapps/ROOT.war
    environment:
      - TZ=Europe/Paris
      - JAVA_OPTS=-Xmx512m -Xms256m -Djava.awt.headless=true -Duser.dir=/app -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:8000
      - CATALINA_OPTS=-Dfile.encoding=UTF-8
    restart: unless-stopped
    networks:
      - iot-network

networks:
  iot-network:
    driver: bridge

